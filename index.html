<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Pose Detector</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 420px;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      padding: 20px;
    }

    h1 {
      margin: 0 0 12px 0;
      text-align: center;
      font-size: 20px;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      color: #fff;
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .webcam {
      display: flex;
      justify-content: center;
      margin-bottom: 12px;
    }

    .zone {
      padding: 14px;
      border-radius: 14px;
      margin-bottom: 10px;
      color: #fff;
      transition: background-color 0.3s ease;
    }

    .normal {
      background-color: #4caf50;
    }

    .hand {
      background-color: #ff9800;
    }

    .zone-title {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .color-picker {
      margin-top: 6px;
    }

    .label {
      font-size: 13px;
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>자세 인식 시스템</h1>

    <button onclick="init()">Start</button>

    <div id="webcam-container" class="webcam"></div>

    <!-- 일반자세 영역 -->
    <div id="normalZone" class="zone normal">
      <div class="zone-title">일반자세</div>
      <div id="normalLabel" class="label">대기 중</div>
      <input type="color" class="color-picker"
             onchange="changeColor('normalZone', this.value)">
    </div>

    <!-- 손있는자세 영역 -->
    <div id="handZone" class="zone hand">
      <div class="zone-title">손있는자세</div>
      <div id="handLabel" class="label">대기 중</div>
      <input type="color" class="color-picker"
             onchange="changeColor('handZone', this.value)">
    </div>
  </div>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/uT0BUyD9E/";

    let model, webcam;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      model = await tmImage.load(modelURL, metadataURL);

      webcam = new tmImage.Webcam(200, 200, true);
      await webcam.setup();
      await webcam.play();
      window.requestAnimationFrame(loop);

      document.getElementById("webcam-container").appendChild(webcam.canvas);
    }

    async function loop() {
      webcam.update();
      await predict();
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);

      prediction.forEach(p => {
        if (p.className === "일반자세") {
          document.getElementById("normalLabel").innerText =
            `확률: ${p.probability.toFixed(2)}`;
        }

        if (p.className === "손있는자세") {
          document.getElementById("handLabel").innerText =
            `확률: ${p.probability.toFixed(2)}`;
        }
      });
    }

    function changeColor(zoneId, color) {
      document.getElementById(zoneId).style.backgroundColor = color;
    }
  </script>
</body>
</html>
